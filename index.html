<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pushup 100</title>
<link rel="manifest" href="manifest.json" />

<style>
  :root{
    --bg:#000;
    --card:#111;
    --card2:#1c1c1e;
    --text:#fff;
    --muted:rgba(255,255,255,.70);
    --muted2:rgba(255,255,255,.45);
    --green:#32d74b;
    --red:#ff453a;
    --amber:#ffcc00;
    --line:rgba(255,255,255,.10);
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  }

  .wrap{ padding:22px 16px 90px; max-width:560px; margin:0 auto; }

  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    margin:6px 0 14px;
  }
  .title{
    font-size:22px; font-weight:650; letter-spacing:.2px;
  }
  .pill{
    font-size:13px;
    padding:8px 10px;
    border-radius:999px;
    background:var(--card2);
    color:var(--muted);
    border:1px solid var(--line);
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    padding:16px;
    margin:12px 0;
  }

  .grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }

  .label{ color:var(--muted2); font-size:13px; }
  .value{ font-size:34px; font-weight:650; margin-top:6px; }
  .value-sm{ font-size:18px; font-weight:600; }

  .btn{
    width:100%;
    padding:16px 16px;
    border:none;
    border-radius:16px;
    font-size:17px;
    font-weight:600;
  }
  .btn-primary{ background:var(--green); color:#000; }
  .btn-subtle{ background:var(--card2); color:var(--text); border:1px solid var(--line); }
  .btn-danger{ background:rgba(255,69,58,.18); color:var(--text); border:1px solid rgba(255,69,58,.35); }

  .row{
    display:flex; justify-content:space-between; align-items:center;
    gap:10px;
  }

  .tabs{
    position:fixed; left:0; right:0; bottom:0;
    background:rgba(0,0,0,.85);
    backdrop-filter:saturate(180%) blur(18px);
    border-top:1px solid var(--line);
    padding:10px 14px;
    display:flex; gap:10px;
  }
  .tab{
    flex:1;
    padding:12px 10px;
    border-radius:14px;
    border:1px solid var(--line);
    background:var(--card2);
    color:var(--muted);
    font-weight:600;
    font-size:14px;
    text-align:center;
  }
  .tab.active{
    background:#0b0b0c;
    color:#fff;
    border-color:rgba(255,255,255,.18);
  }

  .hidden{ display:none !important; }

  /* Workout screen */
  .hero{
    text-align:center;
    padding:8px 0 0;
  }
  .heroStatus{
    color:var(--muted);
    font-size:15px;
    margin-top:6px;
  }
  .heroBig{
    font-size:64px;
    font-weight:700;
    margin:10px 0 0;
    letter-spacing:-.5px;
  }

  /* Steps list */
  .stepsHeader{
    display:flex; justify-content:space-between; align-items:center;
    margin-bottom:10px;
  }
  .stepsTitle{ font-size:16px; font-weight:650; }
  .chip{
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(50,215,75,.12);
    border:1px solid rgba(50,215,75,.25);
    color:rgba(255,255,255,.85);
  }

  .step{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 10px;
    border-radius:14px;
    border:1px solid var(--line);
    background:#0b0b0c;
    margin:8px 0;
  }
  .stepIcon{
    width:28px; height:28px;
    border-radius:999px;
    background:rgba(255,255,255,.08);
    display:flex; align-items:center; justify-content:center;
    font-size:14px;
  }
  .stepMain{ flex:1; text-align:left; }
  .stepName{ font-weight:650; font-size:14px; }
  .stepSub{ color:var(--muted2); font-size:12px; margin-top:2px; }
  .stepRight{ font-weight:700; font-size:14px; color:rgba(255,255,255,.85); }

  .step.current{
    border-color:rgba(50,215,75,.35);
    background:rgba(50,215,75,.08);
  }
  .step.done{
    opacity:.55;
  }
  .step.done .stepIcon{
    background:rgba(50,215,75,.18);
  }

  /* History */
  .historyItem{
    display:flex; gap:12px; align-items:flex-start;
    padding:12px 12px;
    border-radius:16px;
    border:1px solid var(--line);
    background:#0b0b0c;
    margin:10px 0;
  }
  .badge{
    min-width:34px; height:34px; border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    font-weight:800;
    border:1px solid var(--line);
    background:rgba(255,255,255,.06);
  }
  .badge.ok{ background:rgba(50,215,75,.12); border-color:rgba(50,215,75,.25); }
  .badge.hard{ background:rgba(255,204,0,.10); border-color:rgba(255,204,0,.22); }
  .badge.fail{ background:rgba(255,69,58,.12); border-color:rgba(255,69,58,.25); }

  .historyMain{ flex:1; }
  .historyTop{
    display:flex; justify-content:space-between; gap:12px;
    align-items:flex-start;
  }
  .historyTitle{ font-weight:700; }
  .historyMeta{ color:var(--muted2); font-size:12px; margin-top:4px; }
  .historySets{
    color:rgba(255,255,255,.85);
    font-size:13px;
    margin-top:10px;
    line-height:1.35;
  }

  .smallLink{
    color:rgba(255,255,255,.75);
    text-decoration:underline;
    font-size:13px;
    background:transparent;
    border:none;
    padding:0;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">Pushup 100</div>
      <div class="pill" id="topPill">Level 0 ‚Ä¢ üî• 0</div>
    </div>

    <!-- HOME -->
    <div id="screenHome">
      <div class="card">
        <div class="grid">
          <div>
            <div class="label">Baseline (max -2)</div>
            <div class="value" id="baselineVal">25</div>
          </div>
          <div>
            <div class="label">M√•l i dag</div>
            <div class="value" id="todayTarget">0</div>
          </div>
        </div>

        <div style="margin-top:14px" class="row">
          <div class="label">Fase</div>
          <div class="value-sm" id="phaseVal">1</div>
        </div>
        <div class="row" style="margin-top:8px">
          <div class="label">Estimat til 100</div>
          <div class="value-sm"><span id="etaVal">?</span> uger</div>
        </div>

        <div style="margin-top:14px" class="row">
          <button class="btn btn-primary" onclick="startWorkout()">Start workout</button>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn btn-subtle" onclick="adjustBaseline()">Juster baseline</button>
        </div>
      </div>

      <div class="card">
        <div class="stepsHeader">
          <div class="stepsTitle">Dagens steps</div>
          <div class="chip" id="stepsChip">0 steps</div>
        </div>
        <div id="planPreview"></div>
        <button class="smallLink" onclick="openPlan()">Se hele step-listen</button>
      </div>
    </div>

    <!-- WORKOUT -->
    <div id="screenWorkout" class="hidden">
      <div class="card">
        <div class="hero">
          <div class="heroStatus" id="workoutStatus">Warmup</div>
          <div class="heroBig" id="workoutMain">5:00</div>
        </div>

        <div id="workoutButtons" style="margin-top:12px">
          <button class="btn btn-primary" id="doneBtn" onclick="tapDone()">Done</button>
          <button class="btn btn-danger" style="margin-top:10px" onclick="confirmEnd()">End workout</button>
        </div>

        <div id="ratingArea" class="hidden" style="margin-top:12px">
          <button class="btn btn-primary" onclick="rateWorkout('easy')">F√∏les let</button>
          <button class="btn btn-subtle" onclick="rateWorkout('ok')">Passende</button>
          <button class="btn" style="background:rgba(255,204,0,.16); border:1px solid rgba(255,204,0,.35); color:#fff" onclick="rateWorkout('hard')">For tungt</button>
          <button class="btn" style="background:rgba(255,69,58,.16); border:1px solid rgba(255,69,58,.35); color:#fff" onclick="rateWorkout('fail')">M√•tte p√• kn√¶ / fail</button>
        </div>
      </div>

      <div class="card">
        <div class="stepsHeader">
          <div class="stepsTitle">Step-liste</div>
          <div class="chip"><span id="progressText">0</span></div>
        </div>
        <div id="stepsList"></div>
      </div>
    </div>

    <!-- PLAN (full steps before starting) -->
    <div id="screenPlan" class="hidden">
      <div class="card">
        <div class="stepsHeader">
          <div class="stepsTitle">Dagens step-liste</div>
          <div class="chip" id="planTotalChip">Total: 0</div>
        </div>
        <div id="planFull"></div>
        <button class="btn btn-primary" onclick="startWorkout()">Start workout</button>
        <button class="btn btn-subtle" onclick="goHome()">Tilbage</button>
      </div>
    </div>

    <!-- HISTORY -->
    <div id="screenHistory" class="hidden">
      <div class="card">
        <div class="stepsHeader">
          <div class="stepsTitle">Historik</div>
          <div class="chip">Seneste: <span id="historyCount">0</span></div>
        </div>
        <div id="historyList"></div>
        <button class="btn btn-subtle" onclick="clearHistory()">Nulstil historik</button>
      </div>
    </div>

  </div>

  <div class="tabs">
    <div class="tab active" id="tabHome" onclick="showScreen('home')">Home</div>
    <div class="tab" id="tabWorkout" onclick="showScreen('workout')">Workout</div>
    <div class="tab" id="tabHistory" onclick="showScreen('history')">Historik</div>
  </div>

<script>
/* -------------------------
   State + persistence
-------------------------- */
let baseline = parseInt(localStorage.getItem("baseline") || "25", 10);
let volumeFactor = parseFloat(localStorage.getItem("volumeFactor") || "2.6");
let streak = parseInt(localStorage.getItem("streak") || "0", 10);
let workouts = JSON.parse(localStorage.getItem("workouts") || "[]"); // array of sessions

// Active workout runtime
let steps = [];          // [{type:'warmup'|'set'|'rest'|'done', label, valueSeconds|reps, id}]
let currentStepIndex = 0;
let timer = null;
let remaining = 0;
let performedReps = 0;
let plannedTotal = 0;
let activeSessionId = null;

function saveAll(){
  localStorage.setItem("baseline", String(baseline));
  localStorage.setItem("volumeFactor", String(volumeFactor));
  localStorage.setItem("streak", String(streak));
  localStorage.setItem("workouts", JSON.stringify(workouts));
}

function phase(){
  if (baseline < 30) return 1;
  if (baseline < 60) return 2;
  return 3;
}

/* -------------------------
   Plan generation
   (Atletisk men enkel)
-------------------------- */
function generateSets(total){
  // Apple-fitness-ish: 4 s√¶t i fase 1, 5 s√¶t i fase 2, 4 s√¶t i fase 3 (mere "cluster"/kapacitet)
  if (phase() === 1){
    // j√¶vn fordeling + sidste s√¶t st√∏rre
    const a = Math.round(total * 0.20);
    const b = Math.round(total * 0.22);
    const c = Math.round(total * 0.20);
    const d = total - (a+b+c);
    return [a,b,c,d];
  }
  if (phase() === 2){
    // tempo/density: lidt flere s√¶t
    const a = Math.round(total * 0.22);
    const b = Math.round(total * 0.20);
    const c = Math.round(total * 0.18);
    const d = Math.round(total * 0.18);
    const e = total - (a+b+c+d);
    return [a,b,c,d,e];
  }
  // phase 3: kapacitet/cluster-f√∏lelse
  const a = Math.round(total * 0.38);
  const b = Math.round(total * 0.26);
  const c = Math.round(total * 0.18);
  const d = total - (a+b+c);
  return [a,b,c,d];
}

function buildSteps(){
  const total = Math.max(10, Math.round(baseline * volumeFactor));
  const setsArr = generateSets(total);
  plannedTotal = setsArr.reduce((s,x)=>s+x,0);

  const s = [];
  s.push({ id: cryptoId(), type:"warmup", label:"Warmup", seconds:300 });

  for (let i=0;i<setsArr.length;i++){
    s.push({ id: cryptoId(), type:"set", label:`Set ${i+1}`, reps:setsArr[i] });
    if (i < setsArr.length-1){
      s.push({ id: cryptoId(), type:"rest", label:"Rest", seconds:120 });
    }
  }
  s.push({ id: cryptoId(), type:"done", label:"Complete", seconds:0 });
  steps = s;

  return { total, setsArr };
}

function cryptoId(){
  // simple unique id
  return Math.random().toString(16).slice(2) + Date.now().toString(16);
}

/* -------------------------
   UI helpers
-------------------------- */
function setActiveTab(which){
  document.getElementById("tabHome").classList.toggle("active", which==="home");
  document.getElementById("tabWorkout").classList.toggle("active", which==="workout");
  document.getElementById("tabHistory").classList.toggle("active", which==="history");
}

function showScreen(which){
  // Only allow workout screen if a workout is active; otherwise send to Home
  if (which==="workout" && !activeSessionId){
    which = "home";
  }
  document.getElementById("screenHome").classList.toggle("hidden", which!=="home");
  document.getElementById("screenWorkout").classList.toggle("hidden", which!=="workout");
  document.getElementById("screenHistory").classList.toggle("hidden", which!=="history");
  document.getElementById("screenPlan").classList.add("hidden");

  setActiveTab(which);
  if (which==="history") renderHistory();
}

function goHome(){ showScreen("home"); }

function hapticShort(){
  try{ if (navigator.vibrate) navigator.vibrate(50); }catch(e){}
}
function hapticDone(){
  try{ if (navigator.vibrate) navigator.vibrate([80,40,80]); }catch(e){}
}

function fmtTime(sec){
  const m = Math.floor(sec/60);
  const s = sec % 60;
  return `${m}:${s<10?"0":""}${s}`;
}

function updateTopPill(){
  const lvl = Math.floor(baseline / 5);
  document.getElementById("topPill").innerText = `Level ${lvl} ‚Ä¢ üî• ${streak}`;
}

function estimateWeeksTo100(){
  // simpelt: baseret p√• din baseline ‚Äì vi g√∏r det smartere senere med trend fra historik
  // Realistisk: 1-2 reps baseline pr. uge i snit, afh√¶ngigt af historik
  const recent = workouts.slice(-6).filter(w=>w.completed && w.baselineAfter!=null);
  let weeklyGain = 1.5;
  if (recent.length >= 3){
    // brug faktisk baseline-trend
    const first = recent[0].baselineAfter;
    const last = recent[recent.length-1].baselineAfter;
    const sessions = recent.length-1;
    const gainPerSession = sessions>0 ? (last-first)/sessions : 0;
    // antag 2-3 sessions/uge -> approx 2.3 sessions/uge
    weeklyGain = Math.max(0.5, Math.min(3.0, gainPerSession*2.3));
  }
  const remaining = Math.max(0, 100 - baseline);
  return Math.ceil(remaining / weeklyGain);
}

/* -------------------------
   Render: Home plan preview
-------------------------- */
function renderHome(){
  updateTopPill();
  document.getElementById("baselineVal").innerText = baseline;
  document.getElementById("phaseVal").innerText = phase();
  document.getElementById("todayTarget").innerText = Math.round(baseline * volumeFactor);
  document.getElementById("etaVal").innerText = estimateWeeksTo100();

  const plan = buildSteps(); // rebuild daily plan preview
  const chipText = `${steps.length} steps ‚Ä¢ ${plannedTotal} reps`;
  document.getElementById("stepsChip").innerText = chipText;

  // preview first ~6 steps
  const preview = steps.slice(0,6).map(stepRowHtml).join("");
  document.getElementById("planPreview").innerHTML = preview;
}

function stepRowHtml(st, idx){
  const icon = st.type==="warmup" ? "‚è≥" : (st.type==="rest" ? "‚è±" : (st.type==="set" ? "‚ñ∂Ô∏é" : "‚úì"));
  const right = st.type==="set" ? `${st.reps}` : (st.type==="warmup"||st.type==="rest" ? fmtTime(st.seconds) : "");
  const sub = st.type==="set" ? "Pushups" : (st.type==="rest" ? "Rest" : "Warmup");
  return `
    <div class="step">
      <div class="stepIcon">${icon}</div>
      <div class="stepMain">
        <div class="stepName">${st.label}</div>
        <div class="stepSub">${sub}</div>
      </div>
      <div class="stepRight">${right}</div>
    </div>
  `;
}

function openPlan(){
  // show full steps list BEFORE starting
  buildSteps();
  document.getElementById("screenHome").classList.add("hidden");
  document.getElementById("screenWorkout").classList.add("hidden");
  document.getElementById("screenHistory").classList.add("hidden");
  document.getElementById("screenPlan").classList.remove("hidden");
  setActiveTab("home");

  document.getElementById("planTotalChip").innerText = `Total: ${plannedTotal} reps`;
  document.getElementById("planFull").innerHTML = steps.map(stepRowHtml).join("");
}

/* -------------------------
   Workout flow
-------------------------- */
function startWorkout(){
  // start new session
  buildSteps();
  performedReps = 0;
  currentStepIndex = 0;

  activeSessionId = cryptoId();

  // create session skeleton (marked incomplete until rated)
  const now = new Date();
  const sess = {
    id: activeSessionId,
    dateISO: now.toISOString(),
    plannedTotal: plannedTotal,
    steps: steps.map(s=>({ type:s.type, label:s.label, reps:s.reps||null, seconds:s.seconds||null })),
    performedReps: 0,
    sets: steps.filter(s=>s.type==="set").map(s=>s.reps),
    completed: false,
    rating: null,
    baselineBefore: baseline,
    baselineAfter: null,
    volumeFactorBefore: volumeFactor,
    volumeFactorAfter: null,
    phase: phase()
  };
  workouts.push(sess);
  saveAll();

  // show workout screen
  document.getElementById("screenHome").classList.add("hidden");
  document.getElementById("screenPlan").classList.add("hidden");
  document.getElementById("screenHistory").classList.add("hidden");
  document.getElementById("screenWorkout").classList.remove("hidden");
  setActiveTab("workout");

  document.getElementById("ratingArea").classList.add("hidden");
  document.getElementById("workoutButtons").classList.remove("hidden");
  document.getElementById("doneBtn").classList.remove("hidden");

  renderStepsList();
  runCurrentStep();
}

function renderStepsList(){
  const totalSets = steps.filter(s=>s.type==="set").length;
  const doneSets = steps.slice(0, currentStepIndex).filter(s=>s.type==="set").length;

  document.getElementById("progressText").innerText = `${doneSets}/${totalSets} sets ‚Ä¢ ${performedReps}/${plannedTotal} reps`;

  const html = steps.map((s, idx)=>{
    const icon = s.type==="warmup" ? "‚è≥" : (s.type==="rest" ? "‚è±" : (s.type==="set" ? "‚ñ∂Ô∏é" : "‚úì"));
    const right = s.type==="set" ? `${s.reps}` : (s.type==="warmup"||s.type==="rest" ? fmtTime(s.seconds) : "");
    const sub = s.type==="set" ? "Pushups" : (s.type==="rest" ? "Rest" : (s.type==="warmup" ? "Warmup" : "Finish"));

    let cls = "step";
    if (idx === currentStepIndex) cls += " current";
    if (idx < currentStepIndex) cls += " done";

    return `
      <div class="${cls}">
        <div class="stepIcon">${idx < currentStepIndex ? "‚úì" : icon}</div>
        <div class="stepMain">
          <div class="stepName">${s.label}</div>
          <div class="stepSub">${sub}</div>
        </div>
        <div class="stepRight">${right}</div>
      </div>
    `;
  }).join("");

  document.getElementById("stepsList").innerHTML = html;
}

function runCurrentStep(){
  clearTimer();

  const st = steps[currentStepIndex];

  if (!st){
    finishWorkoutUI();
    return;
  }

  if (st.type === "warmup"){
    document.getElementById("workoutStatus").innerText = "Warmup";
    document.getElementById("doneBtn").classList.add("hidden");
    startTimer(st.seconds, ()=>{ hapticDone(); nextStep(); });
    return;
  }

  if (st.type === "rest"){
    document.getElementById("workoutStatus").innerText = "Rest";
    document.getElementById("doneBtn").classList.add("hidden");
    startTimer(st.seconds, ()=>{ hapticDone(); nextStep(); });
    return;
  }

  if (st.type === "set"){
    document.getElementById("workoutStatus").innerText = st.label;
    document.getElementById("workoutMain").innerText = String(st.reps);
    document.getElementById("doneBtn").classList.remove("hidden");
    return;
  }

  if (st.type === "done"){
    finishWorkoutUI();
  }
}

function startTimer(seconds, onDone){
  remaining = seconds;
  document.getElementById("workoutMain").innerText = fmtTime(remaining);
  timer = setInterval(()=>{
    remaining--;
    document.getElementById("workoutMain").innerText = fmtTime(Math.max(0, remaining));
    if (remaining <= 0){
      clearTimer();
      onDone();
    }
  }, 1000);
}

function clearTimer(){
  if (timer){ clearInterval(timer); timer = null; }
}

function tapDone(){
  const st = steps[currentStepIndex];
  if (!st || st.type !== "set") return;

  performedReps += st.reps;
  hapticShort();

  // update session stored
  const sess = workouts.find(w=>w.id===activeSessionId);
  if (sess){
    sess.performedReps = performedReps;
    saveAll();
  }

  nextStep();
}

function nextStep(){
  currentStepIndex++;
  renderStepsList();
  runCurrentStep();
  renderStepsList();
}

function finishWorkoutUI(){
  clearTimer();
  document.getElementById("workoutStatus").innerText = "Workout complete";
  document.getElementById("workoutMain").innerText = "üî•";
  document.getElementById("workoutButtons").classList.add("hidden");
  document.getElementById("ratingArea").classList.remove("hidden");
  hapticDone();

  renderStepsList();
}

function confirmEnd(){
  const ok = confirm("Vil du afslutte workout? Den bliver gemt som uf√¶rdig.");
  if (!ok) return;

  clearTimer();

  // mark session incomplete
  const sess = workouts.find(w=>w.id===activeSessionId);
  if (sess){
    sess.completed = false;
    sess.rating = "ended";
    sess.performedReps = performedReps;
    saveAll();
  }

  // reset runtime
  activeSessionId = null;
  steps = [];
  currentStepIndex = 0;
  performedReps = 0;
  plannedTotal = 0;

  // go home
  showScreen("home");
  renderHome();
}

/* -------------------------
   Rating -> progression
-------------------------- */
function rateWorkout(level){
  // progression rules (sk√•nsom men effektiv)
  // easy: lidt mere volumen + baseline op
  // ok: lille volumenstigning
  // hard: hold / lidt ned
  // fail: deload
  const beforeBaseline = baseline;
  const beforeVF = volumeFactor;

  if (level === "easy"){
    volumeFactor *= 1.03;
    baseline += 1;
    streak += 1;
  } else if (level === "ok"){
    volumeFactor *= 1.015;
    streak += 1;
  } else if (level === "hard"){
    volumeFactor *= 0.99;
    streak = 0;
  } else if (level === "fail"){
    volumeFactor *= 0.95;
    streak = 0;
  }

  // clamp
  volumeFactor = Math.max(1.6, Math.min(4.0, volumeFactor));
  baseline = Math.max(1, baseline);

  // update session as completed
  const sess = workouts.find(w=>w.id===activeSessionId);
  if (sess){
    sess.completed = true;
    sess.rating = level;
    sess.baselineAfter = baseline;
    sess.volumeFactorAfter = volumeFactor;
    sess.performedReps = performedReps;
  }

  saveAll();

  // end active workout
  activeSessionId = null;
  steps = [];
  currentStepIndex = 0;
  performedReps = 0;
  plannedTotal = 0;

  // go home + refresh
  showScreen("home");
  renderHome();
}

/* -------------------------
   History screen (som dine screenshots)
-------------------------- */
function renderHistory(){
  updateTopPill();

  const list = workouts
    .slice()
    .reverse();

  document.getElementById("historyCount").innerText = String(list.length);

  if (list.length === 0){
    document.getElementById("historyList").innerHTML = `
      <div class="label">Ingen tr√¶ninger endnu. Start en workout fra Home.</div>
    `;
    return;
  }

  const html = list.map(w=>{
    const d = new Date(w.dateISO);
    const dateText = d.toLocaleDateString("da-DK", { year:"numeric", month:"2-digit", day:"2-digit" });
    const timeText = d.toLocaleTimeString("da-DK", { hour:"2-digit", minute:"2-digit" });

    let badgeClass = "ok";
    let badgeChar = "‚úì";
    let ratingText = "OK";

    if (w.rating === "easy"){ badgeClass="ok"; badgeChar="‚úì"; ratingText="Let"; }
    if (w.rating === "ok"){ badgeClass="ok"; badgeChar="‚úì"; ratingText="Passende"; }
    if (w.rating === "hard"){ badgeClass="hard"; badgeChar="!"; ratingText="H√•rd"; }
    if (w.rating === "fail"){ badgeClass="fail"; badgeChar="√ó"; ratingText="Fail/kn√¶"; }
    if (w.rating === "ended"){ badgeClass="fail"; badgeChar="‚èπ"; ratingText="Afsluttet"; }

    const planned = w.plannedTotal ?? 0;
    const performed = w.performedReps ?? 0;

    const setsText = (w.sets && w.sets.length)
      ? w.sets.join("  ")
      : "";

    return `
      <div class="historyItem">
        <div class="badge ${badgeClass}">${badgeChar}</div>
        <div class="historyMain">
          <div class="historyTop">
            <div>
              <div class="historyTitle">${dateText} ${timeText}</div>
              <div class="historyMeta">
                Phase ${w.phase ?? "-"} ‚Ä¢ ${ratingText} ‚Ä¢ Baseline ${w.baselineBefore ?? "-"} ‚Üí ${w.baselineAfter ?? w.baselineBefore ?? "-"}
              </div>
            </div>
            <div style="text-align:right">
              <div class="historyTitle">${performed}/${planned}</div>
              <div class="historyMeta">reps</div>
            </div>
          </div>

          <div class="historySets">
            Sets: ${setsText || "<span style='color:rgba(255,255,255,.45)'>-</span>"}
          </div>
        </div>
      </div>
    `;
  }).join("");

  document.getElementById("historyList").innerHTML = html;
}

function clearHistory(){
  const ok = confirm("Nulstil historik? Det kan ikke fortrydes.");
  if (!ok) return;
  workouts = [];
  saveAll();
  renderHistory();
}

/* -------------------------
   Baseline adjust
-------------------------- */
function adjustBaseline(){
  const val = prompt("Ny baseline (max -2):", String(baseline));
  if (!val) return;
  const n = parseInt(val, 10);
  if (!Number.isFinite(n) || n < 1) return;
  baseline = n;
  saveAll();
  renderHome();
}

/* -------------------------
   Init
-------------------------- */
renderHome();
showScreen("home");
</script>
</body>
</html>
